{% extends "templates/employees/list/_base.html" %}

{% set current_page = 'pivot' %}
{% block tail_script %}
    <script>
        (function($) {
            $(function(){
                $('#roleoption-{{check}}').attr("selected", "selected");
                $('#roleselect').change(function (){
                    debugger;
                    var year = $(this).val();
                    window.location = '{{ request.url_for("/employees/list/pivot")}}?role='+year;
                });
            });
        })(jQuery);


    </script>


{% endblock %}
{% block body %}
<div id="clients_pivot" ng-app ng-controller="pivotCtrl">
        <div class="role_select">
            <label>{% trans %}Role{% endtrans %}</label>
            <select id="roleselect">
                   <option value="">All</option>
                {% for role in roles %}
                    <option id="roleoption-{{ role[0] }}" value="{{role[0]}}">{{ role[1] }}</option>
                {% endfor %}
            </select>

        </div>
        <div class="clear"></div>
        <div class="row-fluid">
            <div class="span6 table_pivot">
                <table class="table table-bordered table-hover">
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <colgroup class=""></colgroup>
                <thead class="first">
                <tr>
                    <th class="client">Year</th>
                    <th class="worked annually_hours ">Sum</th>
                    {% for i in range(4) %}
                        <th class="quarter">Q{{ i+1 }}</th>
                    {% endfor %}
                    {% for i in range(12) %}
                        <th class="month {% if loop.last %}last_month{% endif %}">{{ i+1 }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                    {% for year, s in start | dictsort %}
                    <tr class="">
                        {% set quarters = quarters_sum(s) %}
                        <td class="current_year">{{ year }}</td>
                        <td class="annually_hours">
                            <a href="/user/list#/?year_start={{year}}/01/01&role={{check}}">{{ s[:12] | sum }}</a>
                            <a href="/user/list#/?year_stop={{year}}/01/01&role={{check}}" class="stop_work">({{ s[12:] | sum }})</a>
                        </td>
                        {% for q in range(4) %}
                            <td class="quarter">
                                <a href="/user/list#/?quater_start={{year}}/{{q*3+1}}/01&role={{check}}&q={{q+1}}">{{ quarters[q] }}</a>
                                <a href="/user/list#/?quater_stop={{year}}/{{q*3+1}}/01&role={{check}}&q={{q+1}}" class="stop_work">({{ quarters[q+4] }})</a>
                            </td>
                        {% endfor %}
                        {% for month in range(12) %}
                                <td class="month" id="{{year}}/{{month}}">
                                    <a href="/user/list#/?month_start={{year}}/{{month+1}}/01&role={{check}}">{{ s[month] }}</a>
                                    <a href="/user/list#/?month_stop={{year}}/{{month+1}}/01&role={{check}}" class="stop_work">({{ s[month+12] }})</a>
                                </td>
                        {% endfor %}
                    </tr>
                {% endfor %}

                </tbody>
                </table>
            </div>
            <div class="span6 chart_pivot">

            </div>
        </div>
    </div>
    <div class="clear"></div>
{% endblock body %}